# äº¤äº’å¼ Deep Agent ä½¿ç”¨æŒ‡å—

## ç®€ä»‹

`interactive_deep_agent.erl` æ˜¯ä¸€ä¸ªå®Œæ•´çš„äº¤äº’å¼ Deep Agent ç¤ºä¾‹ï¼Œå±•ç¤ºäº†å¦‚ä½•åˆ›å»ºä¸€ä¸ªå¯ä»¥æŒç»­å¯¹è¯çš„æ™ºèƒ½åŠ©æ‰‹ã€‚

## ç‰¹æ€§

### æ ¸å¿ƒåŠŸèƒ½
- âœ… **æŒç»­å¯¹è¯** - Agent ä¿æŒè¿è¡ŒçŠ¶æ€ï¼Œæ”¯æŒå¤šè½®å¯¹è¯
- âœ… **Planningï¼ˆè®¡åˆ’ï¼‰** - Agent å¯ä»¥åˆ¶å®šå¹¶è·Ÿè¸ªæ‰§è¡Œè®¡åˆ’
- âœ… **Reflectionï¼ˆåæ€ï¼‰** - Agent å¯ä»¥åæ€è¿›å±•å¹¶è°ƒæ•´ç­–ç•¥
- âœ… **å­ä»»åŠ¡æ´¾ç”Ÿ** - æ”¯æŒå°†å¤æ‚ä»»åŠ¡åˆ†è§£ä¸ºå­ä»»åŠ¡
- âœ… **å·¥å…·è°ƒç”¨** - å†…ç½®å¤šä¸ªå®ç”¨å·¥å…·
- âœ… **å‘½ä»¤ç³»ç»Ÿ** - æ”¯æŒç‰¹æ®Šå‘½ä»¤æŸ¥çœ‹çŠ¶æ€

### å†…ç½®å·¥å…·
1. **search_web** - æœç´¢ç½‘ç»œä¿¡æ¯
2. **calculate** - æ‰§è¡Œæ•°å­¦è®¡ç®—
3. **get_current_time** - æŸ¥è¯¢å½“å‰æ—¶é—´
4. **save_note** - ä¿å­˜ç¬”è®°

### ç‰¹æ®Šå‘½ä»¤
- `quit` / `exit` - é€€å‡ºäº¤äº’
- `trace` - æŸ¥çœ‹æ‰§è¡Œè½¨è¿¹
- `plan` - æŸ¥çœ‹å½“å‰è®¡åˆ’

## ä½¿ç”¨æ–¹æ³•

### æ–¹æ³• 1: ç›´æ¥è¿è¡Œ

```erlang
%% ç¼–è¯‘
rebar3 compile

%% å¯åŠ¨ Erlang shell
erl -pa _build/default/lib/*/ebin

%% è¿è¡Œ
interactive_deep_agent:run().
```

### æ–¹æ³• 2: ä½¿ç”¨ rebar3 shell

```bash
rebar3 shell
```

ç„¶ååœ¨ shell ä¸­ï¼š

```erlang
interactive_deep_agent:run().
```

## ä½¿ç”¨ç¤ºä¾‹

### ç¤ºä¾‹ 1: ç®€å•å¯¹è¯

```
>>> ä½ å¥½

[æ€è€ƒä¸­...]

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ä½ å¥½ï¼æˆ‘æ˜¯ä½ çš„æ™ºèƒ½åŠ©æ‰‹ã€‚æˆ‘å¯ä»¥å¸®ä½ ï¼š
- æœç´¢ç½‘ç»œä¿¡æ¯
- è¿›è¡Œæ•°å­¦è®¡ç®—
- æŸ¥è¯¢æ—¶é—´
- ä¿å­˜ç¬”è®°
- åˆ¶å®šè®¡åˆ’å¹¶æ‰§è¡Œå¤æ‚ä»»åŠ¡

æœ‰ä»€ä¹ˆæˆ‘å¯ä»¥å¸®åŠ©ä½ çš„å—ï¼Ÿ
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

>>>
```

### ç¤ºä¾‹ 2: ä½¿ç”¨å·¥å…·

```
>>> å¸®æˆ‘è®¡ç®— 25 * 4 + 100

[æ€è€ƒä¸­...]

  ğŸ§® [è®¡ç®—] 25 * 4 + 100

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
è®©æˆ‘æ¥å¸®ä½ è®¡ç®—ï¼š

25 Ã— 4 = 100
100 + 100 = 200

ç­”æ¡ˆæ˜¯ 200
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

[ç»Ÿè®¡: è¿­ä»£ 1 æ¬¡ï¼Œå·¥å…·è°ƒç”¨ 1 æ¬¡]
```

### ç¤ºä¾‹ 3: å¤æ‚ä»»åŠ¡ï¼ˆå¸¦è®¡åˆ’ï¼‰

```
>>> å¸®æˆ‘è§„åˆ’ä¸€æ¬¡å»åŒ—äº¬çš„æ—…è¡Œ

[æ€è€ƒä¸­...]

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
è®©æˆ‘ä¸ºä½ åˆ¶å®šä¸€ä¸ªåŒ—äº¬æ—…è¡Œè®¡åˆ’ï¼

æˆ‘ä¼šå…ˆæœç´¢ç›¸å…³ä¿¡æ¯ï¼Œç„¶åç»™ä½ ä¸€ä¸ªè¯¦ç»†çš„è®¡åˆ’ã€‚
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

[ç»Ÿè®¡: è¿­ä»£ 3 æ¬¡ï¼Œå·¥å…·è°ƒç”¨ 2 æ¬¡]
```

### ç¤ºä¾‹ 4: æŸ¥çœ‹è®¡åˆ’

```
>>> plan

å½“å‰è®¡åˆ’:
  ç›®æ ‡: è§„åˆ’åŒ—äº¬æ—…è¡Œ
  [1] completed: æœç´¢åŒ—äº¬æ™¯ç‚¹ä¿¡æ¯
  [2] in_progress: åˆ¶å®šè¡Œç¨‹å®‰æ’
  [3] pending: è®¡ç®—é¢„ç®—
```

### ç¤ºä¾‹ 5: æŸ¥çœ‹æ‰§è¡Œè½¨è¿¹

```
>>> trace

æ‰§è¡Œè½¨è¿¹ (5 æ¡):
  - #{type => tool_call, name => <<"search_web">>, ...}
  - #{type => llm_response, content => ...}
  - #{type => checkpoint, label => ...}
  ...
```

## Agent é…ç½®

### åˆ›å»º Agent

```erlang
create_assistant() ->
    Opts = #{
        name => <<"æ™ºèƒ½åŠ©æ‰‹">>,
        max_depth => 2,                 %% å…è®¸å­ä»»åŠ¡
        planning_enabled => true,        %% å¯ç”¨è®¡åˆ’
        reflection_enabled => true,      %% å¯ç”¨åæ€
        tools => Tools,                 %% å·¥å…·åˆ—è¡¨
        max_iterations => 15,            %% æœ€å¤§è¿­ä»£æ¬¡æ•°
        system_prompt => Prompt          %% ç³»ç»Ÿæç¤ºè¯
    },
    beamai_deepagent:start_link(AgentId, Opts).
```

### è‡ªå®šä¹‰å·¥å…·

```erlang
#{
    name => <<"my_tool">>,
    description => <<"å·¥å…·æè¿°">>,
    parameters => #{
        type => object,
        properties => #{
            <<"param">> => #{
                type => string,
                description => <<"å‚æ•°æè¿°">>
            }
        },
        required => [<<"param">>]
    },
    handler => fun(Args) ->
        %% å·¥å…·é€»è¾‘
        #{result => <<"è¿”å›å€¼">>}
    end
}
```

## é«˜çº§åŠŸèƒ½

### 1. å¯¹è¯å†å²

Agent è‡ªåŠ¨ç»´æŠ¤å¯¹è¯å†å²ï¼Œæ”¯æŒå¤šè½®å¯¹è¯ï¼š

```
>>> æˆ‘å« David

å¥½çš„ï¼ŒDavidï¼å¾ˆé«˜å…´è®¤è¯†ä½ ã€‚

>>> æˆ‘å«ä»€ä¹ˆåå­—ï¼Ÿ

ä½ çš„åå­—æ˜¯ Davidã€‚
```

### 2. è®¡åˆ’æ›´æ–°

Agent å¯ä»¥åŠ¨æ€æ›´æ–°è®¡åˆ’ï¼š

```
>>> plan

å½“å‰è®¡åˆ’:
  [1] completed: æ­¥éª¤1
  [2] in_progress: æ­¥éª¤2  <-- å½“å‰è¿›è¡Œä¸­
  [3] pending: æ­¥éª¤3
```

### 3. åæ€è°ƒæ•´

å¯ç”¨åæ€åï¼ŒAgent ä¼šï¼š
- åˆ†æå½“å‰è¿›å±•
- è¯†åˆ«é—®é¢˜å’Œéšœç¢
- è°ƒæ•´æ‰§è¡Œç­–ç•¥
- å†³å®šä¸‹ä¸€æ­¥è¡ŒåŠ¨

### 4. å­ä»»åŠ¡æ´¾ç”Ÿ

å¯¹äºå¤æ‚ä»»åŠ¡ï¼ŒAgent å¯ä»¥ï¼š
- æ´¾ç”Ÿå­ Agent å¤„ç†å­ä»»åŠ¡
- å¹¶è¡Œæ‰§è¡Œå¤šä¸ªå­ä»»åŠ¡
- æ±‡æ€»å­ä»»åŠ¡ç»“æœ
- ç»§ç»­ä¸»ä»»åŠ¡æµç¨‹

## è°ƒè¯•å’Œç›‘æ§

### æŸ¥çœ‹æ‰§è¡Œè½¨è¿¹

```
>>> trace
```

æ˜¾ç¤ºæœ€è¿‘çš„æ‰§è¡Œè®°å½•ï¼ŒåŒ…æ‹¬ï¼š
- å·¥å…·è°ƒç”¨
- LLM å“åº”
- æ£€æŸ¥ç‚¹
- åæ€è®°å½•
- å­ä»»åŠ¡æ´¾ç”Ÿ

### æŸ¥çœ‹å½“å‰è®¡åˆ’

```
>>> plan
```

æ˜¾ç¤ºï¼š
- è®¡åˆ’ç›®æ ‡
- æ­¥éª¤åˆ—è¡¨
- æ¯ä¸ªæ­¥éª¤çš„çŠ¶æ€

## æ‰©å±•å»ºè®®

### æ·»åŠ æ›´å¤šå·¥å…·

```erlang
%% æ–‡ä»¶æ“ä½œå·¥å…·
#{
    name => <<"read_file">>,
    description => <<"è¯»å–æ–‡ä»¶å†…å®¹">>,
    parameters => #{
        type => object,
        properties => #{
            <<"path">> => #{type => string}
        },
        required => [<<"path">>]
    },
    handler => fun(Args) ->
        Path = maps:get(<<"path">>, Args),
        case file:read_file(binary_to_list(Path)) of
            {ok, Content} ->
                #{content => Content};
            {error, Reason} ->
                #{error => atom_to_list(Reason)}
        end
    end
}
```

### é›†æˆçœŸå® API

```erlang
%% ä½¿ç”¨çœŸå®çš„å¤©æ°” API
handler => fun(Args) ->
    City = maps:get(<<"city">>, Args),
    case agent_tool_weather:query(City) of
        {ok, Weather} ->
            Weather;
        {error, Reason} ->
            #{error => Reason}
    end
end
```

### æ·»åŠ æŒä¹…åŒ–

```erlang
%% å¯åŠ¨æ—¶åŠ è½½å†å²
init([AgentId, Opts]) ->
    History = load_history(AgentId),
    State = #state{history = History},
    {ok, State}.

%% é€€å‡ºæ—¶ä¿å­˜å†å²
terminate(_Reason, #state{history = History}) ->
    save_history(AgentId, History),
    ok.
```

## æ³¨æ„äº‹é¡¹

1. **API Key é…ç½®**
   - ç¡®ä¿è®¾ç½®äº†ç¯å¢ƒå˜é‡ï¼ˆå¦‚ `ZHIPU_API_KEY`ï¼‰
   - æˆ–åœ¨é…ç½®ä¸­ç›´æ¥æä¾› API key

2. **è¶…æ—¶è®¾ç½®**
   - GLM-4.6 å“åº”è¾ƒæ…¢ï¼Œå»ºè®®è®¾ç½® `timeout => 120000` (120ç§’)
   - ä½¿ç”¨ `connect_timeout` å’Œ `recv_timeout`ï¼ˆä¸è¦ä½¿ç”¨ `timeout`ï¼‰

3. **å¹¶å‘é™åˆ¶**
   - GLM-4.6 å¹¶å‘é™åˆ¶ä¸º 3
   - å»ºè®®ä½¿ç”¨ `glm_concurrency` æ¨¡å—é™åˆ¶å¹¶å‘

4. **æˆæœ¬æ§åˆ¶**
   - è®¾ç½® `max_iterations` é˜²æ­¢æ— é™å¾ªç¯
   - è®¾ç½® `max_depth` é˜²æ­¢è¿‡æ·±çš„å­ä»»åŠ¡åµŒå¥—

## ç›¸å…³æ–‡ä»¶

- [å·¥å…·å‚è€ƒæ–‡æ¡£](../doc/TOOLS_REFERENCE.md)
- [Deep Agent ç¤ºä¾‹](deep_agent_example.erl)
- [Simple Agent ç¤ºä¾‹](simple_agent_example.erl)
- [Agent å·¥å…·å®šä¹‰](../apps/beamai_agent/src/factory/beamai_deepagent_tools.erl)

## æ•…éšœæ’é™¤

### Agent æ²¡æœ‰å“åº”

æ£€æŸ¥ï¼š
1. API Key æ˜¯å¦æ­£ç¡®
2. ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸
3. LLM é…ç½®æ˜¯å¦æ­£ç¡®

### å·¥å…·è°ƒç”¨å¤±è´¥

æ£€æŸ¥ï¼š
1. å·¥å…·å‚æ•°æ˜¯å¦æ­£ç¡®
2. å·¥å…·å¤„ç†å™¨æ˜¯å¦æŠ›å‡ºå¼‚å¸¸
3. æŸ¥çœ‹å®Œæ•´çš„é”™è¯¯ä¿¡æ¯

### Agent å¾ªç¯æ‰§è¡Œ

æ£€æŸ¥ï¼š
1. æ˜¯å¦è®¾ç½®äº† `max_iterations`
2. LLM æ˜¯å¦èƒ½å¤Ÿå®Œæˆä»»åŠ¡
3. ä½¿ç”¨ `trace` å‘½ä»¤æŸ¥çœ‹æ‰§è¡Œè¿‡ç¨‹

## åé¦ˆå’Œè´¡çŒ®

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·ï¼š
- æäº¤ Issue
- å‘èµ· Pull Request
- è”ç³»ç»´æŠ¤è€…

---

**ç¥ä½ ä½¿ç”¨æ„‰å¿«ï¼** ğŸ‰
